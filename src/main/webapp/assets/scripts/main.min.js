function go_signin(){swal({title:"提示信息",text:"您没有登录，3秒后跳转到登录页面！",type:"warning",confirmButtonText:"点击跳转",timer:3000},function(a){if(a){setTimeout(function(){window.location.href=BASE+"/signin"},300)}else{window.location.href=BASE+"/signin"}})}function len(b){var c,a=0;for(c in b){if(b.hasOwnProperty(c)){a++}}return a}function openWindow(b,a,c,f){var b;var a;var c;var f;var e=(window.screen.availHeight-30-f)/2;var d=(window.screen.availWidth-10-c)/2;window.open(b,a,"height="+f+",,innerHeight="+f+",width="+c+",innerWidth="+c+",top="+e+",left="+d+",status=no,toolbar=no,menubar=no,location=no,resizable=no,scrollbars=0,titlebar=no")}function alertError(a){swal({title:"提示信息",text:a,type:"error",timer:3000})}function alertOk(a){swal({title:"提示信息",text:a,type:"success",timer:3000})}function dispatch(){var b=document.getElementById("q");if(b.value!=""){var a="https://www.google.com/search?q=site:java-china.org/topic%20"+b.value;if(navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("iPod")>-1||navigator.userAgent.indexOf("iPhone")>-1){location.href=a}else{window.open(a,"_blank")}return false}else{return false}}function emoji(a){if(a){if(a.indexOf(":")==-1){return a}return a.replace(/:([a-z\\-]{2,30}):/g,'<i class="twa twa-lg twa-$1"></i>')}return""}var topic={};topic.add=function(){var a=$("#topic-add").serialize();$.post(BASE+"/topic/add",a,function(b){if(b){if(b.status==200){window.location.href=BASE+"/topic/"+b.data}else{if(b.status==401){go_signin()}else{alertError(b.msg)}}}})};topic.edit=function(){var a=$("#topic-edit").serialize();$.post(BASE+"/topic/edit",a,function(b){if(b){if(b.status==200){window.location.href=BASE+"/topic/"+b.data}else{if(b.status==401){go_signin()}else{alertError(b.msg)}}}})};$(".topic-footer .heart").on("click",function(){var a=$(this).attr("id");var g=a.split("like");var b=g[1];var e=parseInt($("#likeCount").text());$(this).css("background-position","");var d=$("#likeCount");var f=$(this);var c=$(this).attr("tid");$.post(BASE+"/favorite",{type:"love",event_id:c},function(h){if(h){if(h.status==200){if(h.data==1){d.text(e+1);f.addClass("heartAnimation").attr("rel","unlike")}if(h.data==-1){d.text(e-1);f.removeClass("heartAnimation").attr("rel","like");f.css("background-position","left")}}else{if(h.status==401){go_signin()}else{alertError(h.msg)}}}})});$(".topic-footer .follow").on("click",function(){var a=$(this).attr("tid");var b=$(this);$.post(BASE+"/favorite",{type:"topic",event_id:a},function(c){if(c){if(c.status==200){window.location.reload()}else{if(c.status==401){go_signin()}else{alertError(c.msg)}}}})});$(".topic-footer .essence").on("click",function(){var a=$(this).attr("tid");var b=$(this);$.post(BASE+"/essence",{tid:a},function(c){if(response){if(response.status==200){window.location.reload()}else{if(response.status==401){go_signin()}else{alertError(response.msg)}}}})});$(".topic-footer .share-weibo").on("click",function(){var a="http://service.weibo.com/share/share.php?url="+window.location.href+"&title="+$(".topic-detail-heading .panel-title").text();openWindow(a,"",550,422)});$(".comment-list .at-user").on("click",function(){var d=$(this).attr("alt");var b=$("#comment-form #content");var e=b.val();var a="@"+d+" ";if(e==a){b.val("")}else{var c=e?"\r\n":"";b.val(e+c+a)}b.focus()});var user={};$(".profile .following").on("click",function(){var a=$(this).attr("uid");var b=$(this);$.post(BASE+"/favorite",{type:"following",event_id:a},function(c){if(c){if(c.status==200){window.location.reload()}else{if(c.status==401){go_signin()}else{alertError(c.msg)}}}})});var info_data={};$("#info_form :input").change(function(){var a=$(this).attr("name");info_data[a]=$(this).val()});$("#info_form .submit").on("click",function(){if(len(info_data)>0){$.post(BASE+"/settings?type=info",info_data,function(a){info_data={};if(a){if(a.status==200){window.location.reload()}else{if(a.status==401){go_signin()}else{alertError(a.msg)}}}})}});user.update_avatar=function(){var a=$("#avatar_form #user_avatar").val();if(a&&a!=""){$.post(BASE+"/settings",{type:"avatar",avatar:a},function(b){if(b){if(b.status==200){alertOk("头像更换成功!")}else{if(b.status==401){go_signin()}else{alertError(b.msg)}}}})}};user.update_pwd=function(){var a=$("#pwd_form").serialize();$.post(BASE+"/settings?type=pwd",a,function(b){if(b){if(b.status==200){alertOk("密码修改成功!")}else{if(b.status==401){go_signin()}else{alertError(b.msg)}}}})};var github={};github.signup=function(){$.post(BASE+"/oauth/user/bind",{type:"signup",login_name:$("#github_signup_form #login_name").val(),email:$("#github_signup_form #email").val(),pass_word:$("#github_signup_form #pass_word").val()},function(a){if(a){if(a=="exist_login"){alertError("用户已存在，请绑定已有帐号!")}if(a=="exist_email"){alertError("邮箱已存在，请绑定已有帐号!")}else{if(a=="success"){$("#github-bind-tab").hide();$("#github-tab-content").hide();$(".col-md-8 #result").show().html("注册成功，已经向您的邮箱 "+$("#github_signup_form #email").val()+" 发送了一封激活申请，请注意查收！")}else{if(a=="failure"){alertError("绑定失败!")}}}}});return false};github.signin=function(){$.post(BASE+"/oauth/user/bind",{type:"signin",login_name:$('#"github_signin_form" #login_name').val(),pass_word:$('#"github_signin_form" #pass_word').val()},function(a){if(a){if(a=="no_user"){alertError("不存在该用户!")}else{if(a=="pwd_error"){alertError("用户名或密码错误!")}else{if(a=="no_active"){alertError("该用户未激活，请激活后进行绑定!")}else{if(a=="success"){window.location.href=BASE}}}}}});return false};
