#include("./common/header.html", {title:"个人设置"})
<div class="container">
    <div class="row">
        <div class="col-md-8">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">用户编辑</h3>
                </div>
                <div class="panel-body">
                	#if(null!=error)<div class="alert alert-danger">${error}</div>#end
                	#if(null!=info)<div class="alert alert-info">${info}</div>#end
                	<form id="info_form" class="form-horizontal" role="form">
                        <div class="form-group">
                            <label for="username" class="col-sm-2 control-label">用户名</label>
                            <div class="col-sm-10">
                            	<p class="form-control-static">${profile.username}</p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email" class="col-sm-2 control-label">电子邮件</label>
                            <div class="col-sm-10">
                                <input type="email" readonly="readonly" class="form-control input-sm" id="email" name="email" value="${profile.email}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="location" class="col-sm-2 control-label">职业</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="jobs" name="jobs" value="${profile.jobs}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="location" class="col-sm-2 control-label">所在地</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="location" name="location" value="${profile.location}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="homepage" class="col-sm-2 control-label">个人主页</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="homepage" name="homepage" value="${profile.homepage}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="signature" class="col-sm-2 control-label">签名</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control input-sm" id="signature" name="signature" value="${profile.signature}">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="introduction" class="col-sm-2 control-label">个人简介</label>
                            <div class="col-sm-10">
                                <textarea class="form-control" id="introduction" name="introduction" rows="3">${profile.introduction}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button type="button" class="btn btn-default btn-sm submit">保存信息</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">更换头像</h3>
                </div>
                <div class="panel-body">
                	#if(null!=avatar_error)<div class="alert alert-danger">${avatar_error}</div>#end
                	#if(null!=avatar_info)<div class="alert alert-success">${avatar_info}</div>#end
                	<form action="${base_url('/settings?type=avatar')}" method="post">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">当前头像</label>
                            <div class="col-sm-10">
                            	<input type="hidden" name="avatar" id="user_avatar" value="${profile.avatar}"/>
                                <img id="upload_img" alt="${profile.username}" src="${profile.avatar}" width="73" height="73" onclick="doUpload()" style="cursor: pointer;" class="img-circle"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                            	<br/>
                                <button type="submit" class="btn btn-primary btn-sm">更换头像</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">修改密码</h3>
                </div>
                <div class="panel-body">
                	#if(null!=pwd_error)<div class="alert alert-danger">${pwd_error}</div>#end
                	#if(null!=pwd_info)<div class="alert alert-danger">${pwd_info}</div>#end
                	<form action="${base_url('/settings?type=pwd')}" class="form-horizontal" role="form" method="post">
                        <div class="form-group">
                            <label for="email" class="col-sm-2 control-label">当前密码</label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control" name="curpwd" value="" required="required" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email" class="col-sm-2 control-label">新密码</label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control input-sm" name="newpwd" value="" required="required"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="email" class="col-sm-2 control-label">确认新密码</label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control input-sm" name="renewpwd" value="" required="required"/>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <button type="submit" class="btn btn-danger btn-sm">更改密码</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div><!-- /.col-md-8 -->
        #include("./common/sidebar.html")
	</div><!-- /.row -->
    </div><!-- /.container -->
#include("./common/footer.html") 
<script type="text/javascript" src="${cdn}/assets/scripts/jquery.upload.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	
	var p1 = {};
	$("#info_form :input").change(function (){
		var key = $(this).attr('name');
		p1[key] = $(this).val();
	});
	
	$("#info_form .submit").on('click', function(){
		console.log(p1);
		$.post("${base_url('/settings?type=info')}", p1, function(data){
			if(data){
				if(data == 'signin'){
					go_signin();
				} else if(data == 'success'){
					swal({
						title:"提示信息", 
						text:"保存成功!", 
						type:"success",
						timer: 2000
					});
				}
			}
		});
	});
	
});
	
//上传方法
function doUpload() {
	// 上传方法
	$.upload({
		// 上传地址
		url: "${base_url('/uploadimg')}", 
		// 文件域名字
		fileName: 'image', 
		// 上传完成后, 返回json, text
		dataType: 'json',
		params : {type:"avatar"},
		// 上传之前回调,return true表示可继续上传
		onSend: function() {
			return true;
		},
		// 上传之后回调
		onComplate: function(data) {
			if(data){
				$("#upload_img").attr('src', data.url);
				$("#user_avatar").val(data.savekey);
			}
		}
	});
}
</script>
</body>
</html>